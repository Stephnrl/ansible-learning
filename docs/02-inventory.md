# Understanding Ansible Inventories

The inventory is a core component of Ansible that defines the hosts and groups you're managing. This document explains how to create, organize, and work with Ansible inventories.

## What is an Inventory?

An inventory is a list of hosts that Ansible can manage, along with variables that control how Ansible interacts with those hosts. Inventories can be static (defined in files) or dynamic (generated by scripts).

## Static Inventories

### Basic Format

The simplest inventory is a text file with host names or IP addresses:

```ini
# Simple inventory
web1.example.com
web2.example.com
db1.example.com
```

### Grouping Hosts

Hosts can be organized into groups:

```ini
# Inventory with groups
[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com
db2.example.com
```

### Group Variables

You can assign variables to groups in the inventory:

```ini
[webservers]
web1.example.com
web2.example.com

[webservers:vars]
http_port=80
ansible_user=ubuntu
```

### Host Variables

Variables can also be assigned to individual hosts:

```ini
[webservers]
web1.example.com http_port=80 ansible_user=ubuntu
web2.example.com http_port=8080 ansible_user=admin
```

### Group of Groups

You can create groups of groups using the `:children` suffix:

```ini
[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com
db2.example.com

[production:children]
webservers
dbservers
```

## YAML Format

Inventories can also be written in YAML format:

```yaml
all:
  children:
    webservers:
      hosts:
        web1.example.com:
          http_port: 80
        web2.example.com:
          http_port: 8080
    dbservers:
      hosts:
        db1.example.com:
        db2.example.com:
```

## Best Practices for Inventory Organization

### Directory Structure

For complex environments, use the following directory structure:

```
inventories/
├── production/
│   ├── hosts               # Production inventory file
│   ├── group_vars/
│   │   ├── all.yml         # Variables for all production hosts
│   │   ├── webservers.yml  # Variables for production webservers
│   │   └── dbservers.yml   # Variables for production database servers
│   └── host_vars/
│       ├── web1.yml        # Variables for web1.example.com
│       └── db1.yml         # Variables for db1.example.com
├── staging/
│   ├── hosts               # Staging inventory file
│   ├── group_vars/
│   │   ├── all.yml         # Variables for all staging hosts
│   │   └── webservers.yml  # Variables for staging webservers
│   └── host_vars/
│       └── web-test.yml    # Variables for web-test.example.com
```

### Group Variables

Put group variables in separate YAML files in the `group_vars` directory:

```yaml
# group_vars/webservers.yml
---
http_port: 80
https_port: 443
```

### Host Variables

Put host variables in separate YAML files in the `host_vars` directory:

```yaml
# host_vars/web1.yml
---
ansible_user: ubuntu
ansible_ssh_private_key_file: ~/.ssh/web1_key
```

## Dynamic Inventories

Dynamic inventories are scripts or plugins that generate inventory data on the fly. They're especially useful when working with cloud providers or other environments where hosts change frequently.

### Using Dynamic Inventory Scripts

Ansible provides inventory scripts for many cloud providers:

```bash
# Using an Azure RM dynamic inventory
ansible-playbook -i azure_rm.yml playbook.yml
```

### Creating Custom Dynamic Inventories

You can create custom dynamic inventory scripts in any language. The script must:

1. Accept the `--list` argument to return all inventory data
2. Accept the `--host [hostname]` argument to return variables for a specific host
3. Return JSON in a specific format

Example Python script structure:

```python
#!/usr/bin/env python

import json
import argparse

def list_inventory():
    inventory = {
        'group': {
            'hosts': ['host1', 'host2'],
            'vars': {
                'group_var': 'value'
            }
        },
        '_meta': {
            'hostvars': {
                'host1': {
                    'var1': 'value1'
                },
                'host2': {
                    'var2': 'value2'
                }
            }
        }
    }
    return inventory

def host_vars(hostname):
    hostvars = {
        'host1': {
            'var1': 'value1'
        },
        'host2': {
            'var2': 'value2'
        }
    }
    return hostvars.get(hostname, {})

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--list', action='store_true')
    parser.add_argument('--host', action='store')
    args = parser.parse_args()

    if args.list:
        print(json.dumps(list_inventory()))
    elif args.host:
        print(json.dumps(host_vars(args.host)))
```

## Inventory Parameters

Common inventory parameters include:

- `ansible_host`: The hostname or IP address to SSH to
- `ansible_port`: The SSH port (default: 22)
- `ansible_user`: The username to SSH as
- `ansible_ssh_private_key_file`: Private key file to use for SSH
- `ansible_connection`: Connection type (ssh, local, docker, etc.)
- `ansible_python_interpreter`: Path to the Python interpreter on the host

Example:

```ini
[webservers]
web1 ansible_host=192.168.1.10 ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/web1.pem
```

## Testing Your Inventory

To test that your inventory is correctly defined:

```bash
# List all hosts
ansible-inventory -i inventory.ini --list

# List hosts in a specific group
ansible-inventory -i inventory.ini --graph webservers

# Check variables for a specific host
ansible-inventory -i inventory.ini --host web1.example.com
```

## Working with Multiple Inventories

You can specify multiple inventory sources:

```bash
# Using multiple inventory files
ansible-playbook -i production.ini -i staging.ini playbook.yml

# Using a directory of inventory files
ansible-playbook -i inventory/ playbook.yml
```

## Patterns: Targeting Hosts and Groups

When running Ansible, you can select which hosts or groups to target
